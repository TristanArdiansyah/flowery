<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>Happy Birthday</title>
    <link rel="stylesheet" href="style.css">
    <link rel="icon" href="favicon.ico" type="image/x-icon">
</head>

<body>
    <!-- Gift Opening Experience -->
    <div class="gift-overlay" id="giftOverlay">
        <div class="gift-container">
            <!-- <div class="gift-message">
                🎁 You have a special gift waiting for you! 🎁
            </div> -->

            <div class="envelope" id="envelope" onclick="openEnvelope()">
                <div class="envelope-flap"></div>
                <div class="envelope-front">
                    
                </div>
                <div class="letter">
                    <h2>Happy Birthday</h2>
                    <p>Dear Nana,</p>
                    <p>I have promised you to give you a bouquet of flowers, and i have promised you a website uniquely mine, and uniquely my work.</p>
                    <p>I am sorry I couldn't give you a real one. I wanted to, but right now it seems not very wise for me to do that.  </p>
                    <p>With all my love,<br>Happy Birthday.</p>
                </div>
                <div class="sparkles" id="sparkles"></div>
            </div>

            <div class="tap-instruction" id="tapInstruction">
                ✨ Tap the envelope to open your letter ✨
            </div>

            <button class="continue-btn" id="continueBtn" onclick="enterApp()" >
                 Open Your Gift Here. 
            </button>
        </div>
    </div>

    <!-- Main App Content -->
    <div class="main-content" id="mainContent">
        
        <div class="app-container">
            <h1>🌸 Flowerify Bouquet 🌸</h1>
            <p class="subtitle">You can make and customize your own bouquet, its just you and your creativity, let loose.</p>
            <div class="tab-buttons">
                <button class="tab-btn active" onclick="showTab('draw')">🎨 Draw</button>
                <button class="tab-btn" onclick="showTab('bouquet')">💐 Bouquet</button>
            </div>

            <!-- Drawing Tab -->
            <div id="drawTab" class="tab-content active" style="background: linear-gradient(to bottom, #f8f9ff 0%, #e8f5e8 100%)">
                <h3 class="section-title">🎨 Draw Your Flowers</h3>
                <canvas id="drawingCanvas" width="320" height="320"></canvas>

                <!-- Color Picker Section -->
                <div class="color-section">
                    <div class="color-header">
                        <span class="color-label">Colors</span>
                        <div class="current-color" id="currentColorDisplay"></div>
                    </div>
                    <div class="color-grid" id="colorGrid"></div>
                    <input type="color" class="custom-color-picker" id="customColorPicker" value="#ff6b9d">
                </div>

                <!-- Tools Section -->
                <div class="tools-section">
                    <div class="tool-buttons">
                        <button class="tool-btn active" id="brushTool" onclick="setTool('brush')">
                            🖌️ Brush
                        </button>
                        <button class="tool-btn" id="eraserTool" onclick="setTool('eraser')">
                            🧹 Eraser
                        </button>
                    </div>

                    <div class="size-control">
                        <span class="size-display" id="sizeLabel">Brush:</span>
                        <input type="range" class="size-slider" min="2" max="30" value="8" id="toolSize">
                        <span class="size-display" id="sizeValue">8px</span>
                    </div>
                </div>

                <div class="action-buttons">
                    <button class="btn" onclick="addFlowerToBouquet()">🌺 Add to Bouquet</button>
                    <button class="btn secondary" onclick="clearCanvas()">🗑️ Clear</button>
                </div>

            </div>

            <!-- Bouquet Tab -->
            <div id="bouquetTab" class="tab-content">
                <h3 class="section-title">💐 Your Bouquet</h3>
                <canvas id="bouquetCanvas" width="320" height="380"></canvas>

                <div class="flowers-gallery" id="flowersGallery"></div>

                <div class="action-buttons">
                    <button class="btn" onclick="saveBouquet()">💾 Save</button>
                    <button class="btn danger" onclick="clearBouquet()">🗑️ Clear</button>
                </div>
            </div>
        </div>

        <div class="message" id="birthdayMessage" style="display: none;">
            🎂 Happy Birthday! Your beautiful bouquet has been created with love 🌹
        </div>
    </div>

    <script>
        // Gift opening functionality
        let envelopeOpened = false;

        function createSparkles() {
            const sparklesContainer = document.getElementById('sparkles');
            for (let i = 0; i < 15; i++) {
                const sparkle = document.createElement('div');
                sparkle.className = 'sparkle';
                sparkle.style.left = Math.random() * 100 + '%';
                sparkle.style.top = Math.random() * 100 + '%';
                sparkle.style.animationDelay = Math.random() * 2 + 's';
                sparklesContainer.appendChild(sparkle);
            }
        }

        function openEnvelope() {
            if (envelopeOpened) return;

            envelopeOpened = true;
            const envelope = document.getElementById('envelope');
            const tapInstruction = document.getElementById('tapInstruction');
            const continueBtn = document.getElementById('continueBtn');

            envelope.classList.add('opened');
            envelope.style.cursor = 'default';

            setTimeout(() => {
                tapInstruction.style.display = 'none';
                continueBtn.style.display = 'inline-block';
            }, 1500);
        }

        function enterApp() {
            const giftOverlay = document.getElementById('giftOverlay');
            const mainContent = document.getElementById('mainContent');

            giftOverlay.classList.add('hidden');

            setTimeout(() => {
                mainContent.classList.add('visible');
                giftOverlay.style.display = 'none';
            }, 800);
        }

        // Initialize sparkles
        createSparkles();
        // Canvas setup
        const drawingCanvas = document.getElementById('drawingCanvas');
        const drawingCtx = drawingCanvas.getContext('2d');
        const bouquetCanvas = document.getElementById('bouquetCanvas');
        const bouquetCtx = bouquetCanvas.getContext('2d');

        // State
        let isDrawing = false;
        let currentColor = '#ff6b9d';
        let currentTool = 'brush';
        let currentSize = 8;
        let flowers = [];
        let bouquetFlowers = [];
        let lastX = 0;
        let lastY = 0;

        // Color palette
        const colorPalette = [
            '#ff6b9d', '#ffeaa7', '#55efc4', '#a29bfe', '#fd79a8', '#6c5ce7',
            '#fd63a2', '#00b894', '#e17055', '#81ecec', '#fab1a0', '#74b9ff',
            '#ff7675', '#00cec9', '#fdcb6e', '#e84393', '#2d3436', '#ffffff'
        ];

        // Initialize color picker
        function initColorPicker() {
            const colorGrid = document.getElementById('colorGrid');
            const currentColorDisplay = document.getElementById('currentColorDisplay');

            colorPalette.forEach(color => {
                const colorOption = document.createElement('div');
                colorOption.className = 'color-option';
                colorOption.style.backgroundColor = color;
                colorOption.onclick = () => setColor(color);
                if (color === currentColor) colorOption.classList.add('selected');
                colorGrid.appendChild(colorOption);
            });

            currentColorDisplay.style.backgroundColor = currentColor;

            // Custom color picker
            document.getElementById('customColorPicker').onchange = (e) => {
                setColor(e.target.value);
            };
        }

        function setColor(color) {
            currentColor = color;
            currentTool = 'brush';
            updateToolUI();
            updateColorUI();
        }

        function updateColorUI() {
            document.getElementById('currentColorDisplay').style.backgroundColor = currentColor;
            document.querySelectorAll('.color-option').forEach(option => {
                option.classList.remove('selected');
                if (option.style.backgroundColor === rgb2hex(currentColor) ||
                    option.style.backgroundColor === currentColor) {
                    option.classList.add('selected');
                }
            });
        }

        function rgb2hex(rgb) {
            if (rgb.charAt(0) === '#') return rgb;
            const values = rgb.match(/\d+/g);
            return values ? '#' + values.map(x => (+x).toString(16).padStart(2, '0')).join('') : rgb;
        }

        function setTool(tool) {
            currentTool = tool;
            updateToolUI();
        }

        function updateToolUI() {
            document.querySelectorAll('.tool-btn').forEach(btn => btn.classList.remove('active'));
            document.getElementById(currentTool + 'Tool').classList.add('active');

            const sizeLabel = document.getElementById('sizeLabel');
            sizeLabel.textContent = currentTool === 'brush' ? 'Brush:' : 'Eraser:';
        }

        // Touch and mouse event handling
        function getEventPos(e) {
            const rect = drawingCanvas.getBoundingClientRect();
            const scaleX = drawingCanvas.width / rect.width;
            const scaleY = drawingCanvas.height / rect.height;

            let x, y;
            if (e.touches && e.touches.length > 0) {
                x = (e.touches[0].clientX - rect.left) * scaleX;
                y = (e.touches[0].clientY - rect.top) * scaleY;
            } else {
                x = (e.clientX - rect.left) * scaleX;
                y = (e.clientY - rect.top) * scaleY;
            }

            return { x, y };
        }

        function startDrawing(e) {
            e.preventDefault();
            isDrawing = true;
            const pos = getEventPos(e);
            lastX = pos.x;
            lastY = pos.y;
            document.body.classList.add('drawing-active');

            // Draw initial point
            drawLine(lastX, lastY, pos.x, pos.y);
        }

        function draw(e) {
            if (!isDrawing) return;
            e.preventDefault();

            const pos = getEventPos(e);
            drawLine(lastX, lastY, pos.x, pos.y);
            lastX = pos.x;
            lastY = pos.y;
        }

        function stopDrawing(e) {
            if (!isDrawing) return;
            isDrawing = false;
            document.body.classList.remove('drawing-active');
        }

        function drawLine(x1, y1, x2, y2) {
            drawingCtx.lineWidth = currentSize;
            drawingCtx.lineCap = 'round';
            drawingCtx.lineJoin = 'round';

            if (currentTool === 'brush') {
                drawingCtx.globalCompositeOperation = 'source-over';
                drawingCtx.strokeStyle = currentColor;
            } else {
                drawingCtx.globalCompositeOperation = 'destination-out';
            }

            drawingCtx.beginPath();
            drawingCtx.moveTo(x1, y1);
            drawingCtx.lineTo(x2, y2);
            drawingCtx.stroke();
        }

        // Event listeners
        drawingCanvas.addEventListener('mousedown', startDrawing);
        drawingCanvas.addEventListener('mousemove', draw);
        drawingCanvas.addEventListener('mouseup', stopDrawing);
        drawingCanvas.addEventListener('mouseout', stopDrawing);

        drawingCanvas.addEventListener('touchstart', startDrawing, { passive: false });
        drawingCanvas.addEventListener('touchmove', draw, { passive: false });
        drawingCanvas.addEventListener('touchend', stopDrawing);
        drawingCanvas.addEventListener('touchcancel', stopDrawing);

        // Tool size control
        document.getElementById('toolSize').addEventListener('input', (e) => {
            currentSize = e.target.value;
            document.getElementById('sizeValue').textContent = currentSize + 'px';
        });

        function clearCanvas() {
            drawingCtx.clearRect(0, 0, drawingCanvas.width, drawingCanvas.height);
            drawStemGuide();
        }

        function drawStemGuide() {
            drawingCtx.save();
            drawingCtx.strokeStyle = '#d1f2eb';
            drawingCtx.lineWidth = 2;
            drawingCtx.setLineDash([5, 5]);
            drawingCtx.globalAlpha = 0.6;
            drawingCtx.globalCompositeOperation = 'source-over';

            drawingCtx.beginPath();
            drawingCtx.moveTo(drawingCanvas.width / 2, drawingCanvas.height - 20);
            drawingCtx.lineTo(drawingCanvas.width / 2, drawingCanvas.height / 2 + 40);
            drawingCtx.stroke();

            // drawingCtx.setLineDash([]);
            // drawingCtx.strokeStyle = '#a8e6cf';
            // drawingCtx.lineWidth = 2;
            // drawingCtx.beginPath();
            // drawingCtx.arc(drawingCanvas.width / 2, drawingCanvas.height / 2 - 20, 40, 0, 2 * Math.PI);
            // drawingCtx.stroke();

            drawingCtx.restore();
        }

        function addFlowerToBouquet() {
            const flowerData = drawingCanvas.toDataURL();
            const flowerImg = new Image();
            flowerImg.onload = function () {
                flowers.push(flowerImg);
                updateFlowersGallery();

                const bouquetTop = 40;
                const bouquetBottom = bouquetCanvas.height - 120;
                const centerX = bouquetCanvas.width / 2;

                const y = bouquetTop + Math.random() * (bouquetBottom - bouquetTop);
                const widthAtY = 120 * (1 - (y - bouquetTop) / (bouquetBottom - bouquetTop) * 0.7);
                const x = centerX + (Math.random() - 0.5) * widthAtY;

                const scale = 0.2 + Math.random() * 0.3;
                const rotation = (Math.random() - 0.5) * 0.6;

                bouquetFlowers.push({
                    img: flowerImg,
                    x: x,
                    y: y,
                    scale: scale,
                    rotation: rotation
                });

                drawBouquet();
                clearCanvas();

                if (bouquetFlowers.length === 1) {
                    document.getElementById('birthdayMessage').style.display = 'block';
                }
            };
            flowerImg.src = flowerData;
        }

        function updateFlowersGallery() {
            const gallery = document.getElementById('flowersGallery');
            gallery.innerHTML = '';

            flowers.forEach((flower, index) => {
                const container = document.createElement('div');
                container.className = 'flower-container';

                const thumbnail = document.createElement('canvas');
                thumbnail.width = 60;
                thumbnail.height = 60;
                thumbnail.className = 'flower-thumbnail';

                const ctx = thumbnail.getContext('2d');
                ctx.drawImage(flower, 0, 0, 60, 60);

                thumbnail.onclick = () => addFlowerToBouquetByIndex(index);

                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-flower-btn';
                deleteBtn.innerHTML = '×';
                deleteBtn.onclick = (e) => {
                    e.stopPropagation();
                    deleteFlower(index);
                };

                container.appendChild(thumbnail);
                container.appendChild(deleteBtn);
                gallery.appendChild(container);
            });
        }

        function deleteFlower(index) {
            flowers.splice(index, 1);
            updateFlowersGallery();
        }

        function addFlowerToBouquetByIndex(index) {
            const flower = flowers[index];

            const bouquetTop = 40;
            const bouquetBottom = bouquetCanvas.height - 120;
            const centerX = bouquetCanvas.width / 2;

            const y = bouquetTop + Math.random() * (bouquetBottom - bouquetTop);
            const widthAtY = 120 * (1 - (y - bouquetTop) / (bouquetBottom - bouquetTop) * 0.7);
            const x = centerX + (Math.random() - 0.5) * widthAtY;

            const scale = 0.2 + Math.random() * 0.3;
            const rotation = (Math.random() - 0.5) * 0.6;

            bouquetFlowers.push({
                img: flower,
                x: x,
                y: y,
                scale: scale,
                rotation: rotation
            });

            drawBouquet();
        }

        function drawBouquet() {
            bouquetCtx.clearRect(0, 0, bouquetCanvas.width, bouquetCanvas.height);

            const gradient = bouquetCtx.createLinearGradient(0, 0, 0, bouquetCanvas.height);
            gradient.addColorStop(0, '#f8f9ff');
            gradient.addColorStop(1, '#e8f5e8');
            bouquetCtx.fillStyle = gradient;
            bouquetCtx.fillRect(0, 0, bouquetCanvas.width, bouquetCanvas.height);



            if (bouquetFlowers.length > 0) {
                const centerX = bouquetCanvas.width / 2;
                const wrapBottom = bouquetCanvas.height - 20;
                const wrapTop = bouquetCanvas.height - 160;

                bouquetCtx.fillStyle = '#f8d7da';
                bouquetCtx.beginPath();
                bouquetCtx.moveTo(centerX - 80, wrapTop - 80);
                bouquetCtx.lineTo(centerX + 80, wrapTop - 80);
                bouquetCtx.lineTo(centerX + 25, wrapBottom);
                bouquetCtx.lineTo(centerX - 25, wrapBottom);
                bouquetCtx.closePath();
                bouquetCtx.fill();

                bouquetFlowers.forEach(flower => {
                    bouquetCtx.strokeStyle = '#4a7c59';
                    bouquetCtx.lineWidth = 2;
                    bouquetCtx.beginPath();
                    bouquetCtx.moveTo(flower.x, flower.y + 15);
                    bouquetCtx.lineTo(bouquetCanvas.width / 2 + (Math.random() - 0.5) * 20, bouquetCanvas.height - 60);
                    bouquetCtx.stroke();
                });

                bouquetCtx.fillStyle = '#f5c6cb';
                bouquetCtx.beginPath();
                bouquetCtx.moveTo(centerX - 45, wrapTop + 45);
                bouquetCtx.lineTo(centerX + 45, wrapTop + 45);
                bouquetCtx.lineTo(centerX + 20, wrapBottom);
                bouquetCtx.lineTo(centerX - 20, wrapBottom);
                bouquetCtx.closePath();
                bouquetCtx.fill();

                bouquetCtx.fillStyle = '#f39c12';
                bouquetCtx.fillRect(centerX - 35, wrapBottom - 40, 70, 10);

                bouquetCtx.fillStyle = '#e67e22';
                bouquetCtx.fillRect(centerX - 6, wrapBottom - 38, 12, 6);
                bouquetCtx.beginPath();
                bouquetCtx.ellipse(centerX - 10, wrapBottom - 35, 6, 4, 0, 0, 2 * Math.PI);
                bouquetCtx.fill();
                bouquetCtx.beginPath();
                bouquetCtx.ellipse(centerX + 10, wrapBottom - 35, 6, 4, 0, 0, 2 * Math.PI);
                bouquetCtx.fill();
            }

            bouquetFlowers.forEach(flower => {
                bouquetCtx.save();
                bouquetCtx.translate(flower.x, flower.y);
                bouquetCtx.rotate(flower.rotation);
                bouquetCtx.scale(flower.scale, flower.scale);
                bouquetCtx.drawImage(flower.img, -drawingCanvas.width / 2, -drawingCanvas.height / 2);
                bouquetCtx.restore();
            });
        }

        function clearBouquet() {
            bouquetFlowers = [];
            drawBouquet();
            document.getElementById('birthdayMessage').style.display = 'none';
        }

        function saveBouquet() {
            const link = document.createElement('a');
            link.download = 'my-flower-bouquet.png';
            link.href = bouquetCanvas.toDataURL();
            link.click();
        }

        function showTab(tabName) {
            document.querySelectorAll('.tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));

            document.querySelector(`[onclick="showTab('${tabName}')"]`).classList.add('active');
            document.getElementById(tabName === 'draw' ? 'drawTab' : 'bouquetTab').classList.add('active');
        }

        // Initialize
        initColorPicker();
        drawBouquet();
        drawStemGuide();
    </script>
</body>

</html>